<script src=http://localhost:3000/socket.io/socket.io.js ></script>
<script>
  const socket = io.connect(`http://localhost:3000`)
  const initialselections = ['$name is at $x, $y']
  const gorogstart = 'gorog is at 0.5, 0.7'
  const gorogmove = 'gorog is at 0.8, 0.4'
  const gorogstartparsed = {name: {word: "gorog"}, x: {value: 0.5}, y:{value: 0.7}}
  const gorogmoveparsed = {name: {word: "gorog"}, x: {value: 0.8}, y:{value: 0.4}}

  const assertEq = (obj1, obj2, why) => {
    let equals = obj1 === obj2
    if (Array.isArray(obj1) && Array.isArray(obj2)) {
      equals = (obj1.length == obj2.length) &&
        obj1.every((el, idx) => JSON.stringify(el) == JSON.stringify(obj2[idx]))
    }
    console.assert(equals, why, obj1, obj2)
  }

  setTimeout(() => {
    let timesChanged = 0
    socket.on(JSON.stringify(initialselections), ({assertions, retractions}) => {
      if (timesChanged === 0) {
        assertEq([gorogstartparsed], assertions, "asserted:gorogstart")
      } else if (timesChanged === 1) {
        assertEq([gorogmoveparsed], assertions, "asserted:gorogmove")
      } else if (timesChanged === 2) {
        assertEq([gorogstartparsed], retractions, "retracted:gorogstart")
      }
      timesChanged++
    })
    socket.emit('subscribe', initialselections)
  }, 050)

  setTimeout(() => {
    socket.emit('assert', [gorogstart])
  }, 100)
  setTimeout(() => {
    socket.emit('assert', [gorogmove])
  }, 200)
  setTimeout(() => {
    socket.emit('retract', [gorogstart])
  }, 300)

</script>
